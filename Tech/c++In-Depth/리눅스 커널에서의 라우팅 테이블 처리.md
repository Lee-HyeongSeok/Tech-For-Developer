## 리눅스 커널에서의 라우팅 테이블 처리

***

<br>

### :pushpin: 라우팅 테이블이란?

- 요청된 데이터 패킷들을 어디로 보낼 것인가를 결정하는 역할

- 라우팅 테이블 확인(리눅스)

  > ```bash
  > netstat -nr 
  > # 또는
  > route
  > ```

<br>

### :pushpin: 라우팅 테이블

- Kernel IP routing table

|  Destination  |     Gateway     |    Genmask    | Flags | Metric | Ref  | Use  | Iface |
| :-----------: | :-------------: | :-----------: | :---: | :----: | :--: | :--: | :---: |
| 192.168.100.0 |        *        | 255.255.255.0 |   U   |   0    |  0   |  0   | eth0  |
|  168.254.0.0  |        *        |  255.255.0.0  |   U   |   0    |  0   |  0   | eth0  |
|   127.0.0.0   |        *        |   255.0.0.0   |   U   |   0    |  0   |  0   |  lo   |
|    default    | 192.168.100.254 |    0.0.0.0    |  UG   |   0    |  0   |  0   | eth0  |

- 기본 게이트웨이 : 192.168.100.254

- 서브넷 마스크 : 255.255.255.0

- 인터페이스 : eth0

  > 외부로 나가는 데이터를 eth0이라는 인터페이스를 통해 설정된 기본 게이트웨이(192.168.100.254)로 보낸다.

- **라우팅 테이블 기본 필드**

  - Destination : 목적지
  - Gateway : 외부 네트워크와 연결하기 위한 게이트웨이 주소
  - Genmask : 목적지 네트워크의 넷마스크 주소
  - Flags : 해당 경로에 대한 정보를 알려주는 기호
    - U(up) : 해당 경로가 살아있는 상태임을 의미
    - H(host) : 목적지가 호스트 주소라는 것을 의미
    - G(gateway) : 게이트웨이를 향하는 경로를 의미
  - Metric : 목적지 네트워크까지의 거리
  - Ref : 경로를 참조한 횟수
  - Use : 경로를 탐색한 횟수
  - Iface : 패킷이 송수신되는 데 사용할 네트워크 인터페이스

<br>

### :pushpin: 라우팅 테이블 규칙

1. 첫 번째 행부터 다음 행으로 차례로 한 행씩 읽어서 처리할 패킷을 보낼 수 있는가를 확인

2. default는 이 서버의 기본 게이트웨이 설정 행을 의미, 그 행의 게이트웨이 항목값이 기본 게이트웨이 IP주소, default는 0.0.0.0을 의미

3. 보낼 데이터의 IP 주소와 Genmask 값(서브넷 마스크)과의 AND 연산을 수행 후, 그 결과가 해당 행의 Destination 항목과 일치할 경우 해당 행의 Iface에 있는 인터페이스로 패킷을 전송

   > **Genmask(Subnetmask)는 데이터 패킷을 로컬로 보낼 것인지 외부로 보낼 것인지 구분하는 역할**

4. Iface 항목이 lo인 행은 이 서버의 루프백(loopback) 데이터를 처리하기 위한 설정, 자신에게 데이터를 보낼 때 처리를 담당하는 인터페이스

<br>

### :pushpin: 라우팅 테이블 패킷 전송 과정

|  Destination  |     Gateway     |    Genmask    | Flags | Metric | Ref  | Use  | Iface |
| :-----------: | :-------------: | :-----------: | :---: | :----: | :--: | :--: | :---: |
| 192.168.100.0 |        *        | 255.255.255.0 |   U   |   0    |  0   |  0   | eth0  |
|  168.254.0.0  |        *        |  255.255.0.0  |   U   |   0    |  0   |  0   | eth0  |
|   127.0.0.0   |        *        |   255.0.0.0   |   U   |   0    |  0   |  0   |  lo   |
|    default    | 192.168.100.254 |    0.0.0.0    |  UG   |   0    |  0   |  0   | eth0  |

> 위 라우팅 테이블로 데이터 패킷을 전송할 때, 패킷의 목적지는 192.168.2.101

1. 라우팅 테이블의 첫 번째 항을 읽는다, 전송 대상 패킷의 목적지(192.168.2.101)와 첫 번째 행의 Genmask(255.255.255.0)을 AND 연산한다.

   > 결과 값이 192.168.2.0 이므로 첫 번째 행의 Destination 값인 192.168.100.0과 다르므로 다음 행으로 넘어간다.

2. 라우팅 테이블의 두 번째 항을 읽는다, 전송 대상 패킷의 목적지(192.168.2.101)와 두 번째 행의 Genmask(255.255.0.0)을 AND 연산한다.

   > 결과 값이 192.168.0.0 이므로 두 번째 행의 Destination 값인 168.254.0.0과 다르므로 다음 행으로 넘어간다.

3. 라우팅 테이블의 세 번째 항을 읽는다, 전송 대상 패킷의 목적지(192.168.2.101)와 세 번째 행의 Genmask(255.0.0.0)을 AND 연산한다.

   > 결과 값이 192.0.0.0 이므로 세 번째 행의 Destination 값인 127.0.0.0과 다르므로 다음 행으로 넘어간다.

4. 라우팅 테이블의 네 번째 항을 읽는다, 전송 대상 패킷의 목적지(192.168.2.101)와 네 번째 행의 Genmask(0.0.0.0)을 AND 연산한다.

   > 결과 값이 0.0.0.0 이므로 네 번째 행의 Destination 값인 default(0.0.0.0)과 일치하므로 네 번째 행의 Iface인 eth0으로 해당 패킷을 전송한다.

<br>

***

### :round_pushpin: 출처

[네이버 블로그](https://blog.naver.com/01191879872/10016858999)